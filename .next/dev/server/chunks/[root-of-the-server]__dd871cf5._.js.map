{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/lordp/IELTS-MVP/src/lib/prisma.ts"],"sourcesContent":["// src/lib/prisma.ts\nimport { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;AACpB;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B","debugId":null}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/lordp/IELTS-MVP/src/pages/api/auth/%5B...nextauth%5D.ts"],"sourcesContent":["// src/pages/api/auth/[...nextauth].ts\nimport type { NextApiRequest, NextApiResponse } from \"next\";\nimport NextAuth, { type NextAuthOptions } from \"next-auth\";\nimport GitHub from \"next-auth/providers/github\";\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport const authOptions: NextAuthOptions = {\n  adapter: PrismaAdapter(prisma),\n  session: {\n    strategy: \"database\",\n  },\n  providers: [\n    GitHub({\n      clientId: process.env.GITHUB_ID!,\n      clientSecret: process.env.GITHUB_SECRET!,\n    }),\n  ],\n  callbacks: {\n    async session({ session, user }) {\n      if (session.user) {\n        (session.user as any).id = user.id;\n      }\n      return session;\n    },\n  },\n};\n\nexport default function auth(req: NextApiRequest, res: NextApiResponse) {\n  return NextAuth(req, res, authOptions);\n}\n"],"names":[],"mappings":"AAAA,sCAAsC;;;;;;;AAEtC;AACA;AACA;AACA;;;;;AAEO,MAAM,cAA+B;IAC1C,SAAS,IAAA,uKAAa,EAAC,gIAAM;IAC7B,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,IAAA,gKAAM,EAAC;YACL,UAAU,QAAQ,GAAG,CAAC,SAAS;YAC/B,cAAc,QAAQ,GAAG,CAAC,aAAa;QACzC;KACD;IACD,WAAW;QACT,MAAM,SAAQ,EAAE,OAAO,EAAE,IAAI,EAAE;YAC7B,IAAI,QAAQ,IAAI,EAAE;gBACf,QAAQ,IAAI,CAAS,EAAE,GAAG,KAAK,EAAE;YACpC;YACA,OAAO;QACT;IACF;AACF;AAEe,SAAS,KAAK,GAAmB,EAAE,GAAoB;IACpE,OAAO,IAAA,kJAAQ,EAAC,KAAK,KAAK;AAC5B","debugId":null}},
    {"offset": {"line": 175, "column": 0}, "map": {"version":3,"sources":["file:///Users/lordp/IELTS-MVP/src/app/api/drafts/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/pages/api/auth/[...nextauth]\";\nimport { prisma } from \"@/lib/prisma\";\n\ntype EssayMode = \"academic\" | \"general\";\ntype EssayTask = \"task1\" | \"task2\";\n\ntype SaveDraftRequest = {\n  questionId: string;\n  mode: EssayMode;\n  task: EssayTask;\n  essay: string;\n};\n\nexport async function POST(req: Request) {\n  try {\n    const session = await getServerSession(authOptions);\n    const userId = (session?.user as any)?.id as string | undefined;\n\n    if (!userId) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    let body: SaveDraftRequest;\n    try {\n      body = (await req.json()) as SaveDraftRequest;\n    } catch {\n      return NextResponse.json({ error: \"Invalid JSON body\" }, { status: 400 });\n    }\n\n    const { questionId, mode, task, essay } = body;\n\n    if (!questionId || !mode || !task) {\n      return NextResponse.json(\n        { error: \"Missing required fields: questionId, mode, task\" },\n        { status: 400 }\n      );\n    }\n\n    // Use Prisma raw SQL to upsert into the existing essay_drafts table\n    const rows = await prisma.$queryRaw<\n      { id: string; updated_at: Date }[]\n    >`\n      insert into essay_drafts (user_id, question_id, mode, task, essay_text)\n      values (${userId}::uuid, ${questionId}, ${mode}, ${task}, ${essay})\n      on conflict (user_id, question_id)\n      do update set\n        essay_text = excluded.essay_text,\n        mode       = excluded.mode,\n        task       = excluded.task,\n        updated_at = now()\n      returning id, updated_at\n    `;\n\n    const row = rows[0];\n    if (!row) {\n      return NextResponse.json(\n        { error: \"Failed to save draft\" },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      id: row.id,\n      updatedAt: row.updated_at.toISOString(),\n    });\n  } catch (err) {\n    console.error(\"Unexpected error in POST /api/drafts:\", err);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function GET(req: Request) {\n  try {\n    const session = await getServerSession(authOptions);\n    const userId = (session?.user as any)?.id as string | undefined;\n\n    if (!userId) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const url = new URL(req.url);\n    const questionId = url.searchParams.get(\"questionId\");\n\n    if (!questionId) {\n      return NextResponse.json(\n        { error: \"Missing questionId in query string\" },\n        { status: 400 }\n      );\n    }\n\n    const rows = await prisma.$queryRaw<\n      {\n        id: string;\n        question_id: string;\n        mode: string;\n        task: string;\n        essay_text: string;\n        updated_at: Date;\n      }[]\n    >`\n      select id, question_id, mode, task, essay_text, updated_at\n      from essay_drafts\n      where user_id = ${userId}::uuid\n        and question_id = ${questionId}\n      limit 1\n    `;\n\n    const row = rows[0];\n\n    if (!row) {\n      // No draft yet for this question for this user\n      return NextResponse.json({ draft: null });\n    }\n\n    return NextResponse.json({\n      draft: {\n        id: row.id,\n        questionId: row.question_id,\n        mode: row.mode as EssayMode,\n        task: row.task as EssayTask,\n        essay: row.essay_text,\n        updatedAt: row.updated_at.toISOString(),\n      },\n    });\n  } catch (err) {\n    console.error(\"Unexpected error in GET /api/drafts:\", err);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAYO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,kKAAW;QAClD,MAAM,SAAU,SAAS,MAAc;QAEvC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,IAAI;QACJ,IAAI;YACF,OAAQ,MAAM,IAAI,IAAI;QACxB,EAAE,OAAM;YACN,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,MAAM,EAAE,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG;QAE1C,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,MAAM;YACjC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkD,GAC3D;gBAAE,QAAQ;YAAI;QAElB;QAEA,oEAAoE;QACpE,MAAM,OAAO,MAAM,gIAAM,CAAC,SAAS,AAElC,CAAC;;cAEQ,EAAE,OAAO,QAAQ,EAAE,WAAW,EAAE,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,MAAM;;;;;;;;IAQpE,CAAC;QAED,MAAM,MAAM,IAAI,CAAC,EAAE;QACnB,IAAI,CAAC,KAAK;YACR,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI,IAAI,EAAE;YACV,WAAW,IAAI,UAAU,CAAC,WAAW;QACvC;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,yCAAyC;QACvD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,kKAAW;QAClD,MAAM,SAAU,SAAS,MAAc;QAEvC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,aAAa,IAAI,YAAY,CAAC,GAAG,CAAC;QAExC,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqC,GAC9C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,SAAS,AASlC,CAAC;;;sBAGgB,EAAE,OAAO;0BACL,EAAE,WAAW;;IAEnC,CAAC;QAED,MAAM,MAAM,IAAI,CAAC,EAAE;QAEnB,IAAI,CAAC,KAAK;YACR,+CAA+C;YAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAK;QACzC;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;gBACL,IAAI,IAAI,EAAE;gBACV,YAAY,IAAI,WAAW;gBAC3B,MAAM,IAAI,IAAI;gBACd,MAAM,IAAI,IAAI;gBACd,OAAO,IAAI,UAAU;gBACrB,WAAW,IAAI,UAAU,CAAC,WAAW;YACvC;QACF;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}