{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///Users/lordp/IELTS-MVP/src/lib/prisma.ts"],"sourcesContent":["// src/lib/prisma.ts\nimport { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;AACpB;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B","debugId":null}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///Users/lordp/IELTS-MVP/src/lib/taskLabels.ts"],"sourcesContent":["// lib/taskLabels.ts\n\nexport const TASK_LABELS: Record<string, string> = {\n  \"a-t2-education\": \"Academic Task 2 — Education\",\n  \"a-t2-environment\": \"Academic Task 2 — Environment\",\n  \"a-t2-technology\": \"Academic Task 2 — Technology & Society\",\n  \"g-t1-letter-neighbour\": \"General Task 1 — Letter to a Neighbour\",\n  \"g-t2-work-life\": \"General Task 2 — Work–Life Balance\",\n  // add more as your dataset grows\n};\n\nexport function formatTaskLabel(taskId: string | null | undefined): string {\n  if (!taskId) return \"Unknown task\";\n  return TASK_LABELS[taskId] ?? taskId; // fallback = raw ID\n}\n\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;;;AAEb,MAAM,cAAsC;IACjD,kBAAkB;IAClB,oBAAoB;IACpB,mBAAmB;IACnB,yBAAyB;IACzB,kBAAkB;AAEpB;AAEO,SAAS,gBAAgB,MAAiC;IAC/D,IAAI,CAAC,QAAQ,OAAO;IACpB,OAAO,WAAW,CAAC,OAAO,IAAI,QAAQ,oBAAoB;AAC5D","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///Users/lordp/IELTS-MVP/src/app/attempts/%5Bid%5D/page.tsx"],"sourcesContent":["// src/app/attempts/[id]/page.tsx\n\nimport { notFound } from \"next/navigation\";\nimport { prisma } from \"@/lib/prisma\";\nimport { formatTaskLabel } from \"@/lib/taskLabels\";\n\n// Next 16: params is a Promise<{ id: string }>\ntype PageProps = {\n  params: Promise<{ id: string }>;\n};\n\ntype AttemptRow = {\n  id: string;\n  created_at: Date | null;\n  question_id: string | null;\n  question_text?: string | null;\n  essay_text: string | null;\n  score_json: unknown;\n};\n\nexport default async function AttemptDetailPage({ params }: PageProps) {\n  // ✅ Unwrap params (Next 16 dynamic route API)\n  const { id: attemptId } = await params;\n\n  // ✅ Read directly from the database via Prisma\n  const rows = await prisma.$queryRaw<AttemptRow[]>`\n    select id, created_at, question_id, question_text, essay_text, score_json\n    from essay_attempts\n    where id = ${attemptId}\n    limit 1\n  `;\n\n  const attempt = rows[0];\n\n  if (!attempt) {\n    notFound();\n  }\n\n  // ---------- Parse score_json safely ----------\n  let score: any | null = null;\n  const rawScore = attempt.score_json;\n\n  if (rawScore && typeof rawScore === \"object\") {\n    score = rawScore;\n  } else if (rawScore && typeof rawScore === \"string\") {\n    try {\n      score = JSON.parse(rawScore);\n    } catch (e) {\n      console.warn(\"Failed to parse score_json for attempt\", attempt.id, e);\n    }\n  }\n\n  const overall =\n    score && typeof score.overall === \"number\" ? score.overall : null;\n\n  const taskResponse =\n    score && typeof score.taskResponse === \"number\"\n      ? score.taskResponse\n      : null;\n  const coherence =\n    score && typeof score.coherence === \"number\" ? score.coherence : null;\n  const lexical =\n    score && typeof score.lexical === \"number\" ? score.lexical : null;\n  const grammar =\n    score && typeof score.grammar === \"number\" ? score.grammar : null;\n\n  const comments = (score?.comments ?? {}) as Record<\n    string,\n    string | undefined\n  >;\n\n  const dateText = attempt.created_at\n    ? attempt.created_at.toLocaleString()\n    : \"unknown date\";\n\n  const taskLabel = attempt.question_id\n    ? formatTaskLabel(attempt.question_id)\n    : \"Unknown task\";\n\n  // Clean up question text: strip leading \"Question:\" and trim\n  let fullQuestionText = attempt.question_text ?? \"\";\n  const lower = fullQuestionText.toLowerCase();\n  if (lower.startsWith(\"question:\")) {\n    fullQuestionText = fullQuestionText.slice(\"question:\".length).trim();\n  }\n\n  return (\n    <main className=\"min-h-dvh bg-white text-slate-900 p-6\">\n      <div className=\"mx-auto max-w-3xl space-y-8\">\n        {/* Header */}\n        <header className=\"space-y-1\">\n          <h1 className=\"text-2xl font-semibold\">Attempt Details</h1>\n          <p className=\"text-xs text-slate-500\">Submitted on {dateText}</p>\n        </header>\n\n        {/* Meta info block */}\n        <section className=\"space-y-1 text-xs text-slate-600\">\n          <p>\n            <span className=\"font-semibold\">Attempt ID:</span> {attempt.id}\n          </p>\n          {attempt.question_id && (\n            <p>\n              <span className=\"font-semibold\">Question ID:</span>{\" \"}\n              {attempt.question_id}\n            </p>\n          )}\n          {attempt.module && (\n            <p>\n              <span className=\"font-semibold\">Module:</span> {attempt.module}\n            </p>\n          )}\n          {attempt.task && (\n            <p>\n              <span className=\"font-semibold\">Task:</span> {attempt.task}\n            </p>\n          )}\n          {attempt.question_text && (\n            <p>\n              <span className=\"font-semibold\">Question prompt:</span>{\" \"}\n              {attempt.question_text}\n            </p>\n          )}\n          {attempt.created_at && (\n            <p>\n              <span className=\"font-semibold\">Created at:</span> {dateText}\n            </p>\n          )}\n        </section>\n\n        {/* Task */}\n        <section className=\"space-y-2\">\n          <h2 className=\"text-lg font-semibold\">Task</h2>\n          <p className=\"text-sm font-medium text-slate-800\">{taskLabel}</p>\n          {attempt.question_id && (\n            <p className=\"text-[11px] text-slate-400\">\n              {attempt.question_id}\n            </p>\n          )}\n          {fullQuestionText && (\n            <p className=\"mt-1 text-xs text-slate-500\">{fullQuestionText}</p>\n          )}\n        </section>\n\n        {/* AI BAND SCORES – premium card layout */}\n        {score && (\n          <section className=\"space-y-4\">\n            <div>\n              <h2 className=\"text-lg font-semibold\">AI band scores</h2>\n              <p className=\"text-xs text-slate-500\">\n                These scores come from the AI examiner for this attempt.\n              </p>\n            </div>\n\n            {/* Overall card */}\n            <div className=\"rounded-xl border border-slate-200 bg-slate-50 p-4 md:p-5\">\n              <p className=\"text-[11px] font-semibold uppercase tracking-wide text-slate-500\">\n                Overall band\n              </p>\n              <div className=\"mt-2 flex items-baseline gap-3\">\n                <span className=\"text-3xl font-semibold\">\n                  {overall ?? \"—\"}\n                </span>\n              </div>\n              {comments.overview && (\n                <p className=\"mt-2 text-sm text-slate-700\">\n                  {comments.overview}\n                </p>\n              )}\n            </div>\n\n            {/* Model + 4 criteria */}\n            <div className=\"grid gap-3 md:grid-cols-5\">\n              {/* Four band cards */}\n              <BandCard\n                label=\"Task response\"\n                value={taskResponse}\n                comment={comments.taskResponse}\n              />\n              <BandCard\n                label=\"Coherence & cohesion\"\n                value={coherence}\n                comment={comments.coherence}\n              />\n              <BandCard\n                label=\"Lexical resource\"\n                value={lexical}\n                comment={comments.lexical}\n              />\n              <BandCard\n                label=\"Grammar range & accuracy\"\n                value={grammar}\n                comment={comments.grammar}\n              />\n            </div>\n\n            {/* Overall advice strip */}\n            {comments.advice && (\n              <div className=\"rounded-xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900\">\n                <p className=\"text-[11px] font-semibold uppercase tracking-wide text-amber-800\">\n                  Overall advice\n                </p>\n                <p className=\"mt-1\">{comments.advice}</p>\n              </div>\n            )}\n          </section>\n        )}\n\n        {/* Essay */}\n        <section className=\"space-y-3\">\n          <h2 className=\"text-lg font-semibold\">Your essay</h2>\n          <div className=\"rounded-md border border-slate-200 bg-slate-50 p-4 text-sm whitespace-pre-wrap text-slate-800\">\n            {attempt.essay_text ?? \"No essay text stored for this attempt.\"}\n          </div>\n        </section>\n      </div>\n    </main>\n  );\n}\n\n/** Small reusable card for each sub-band */\nfunction BandCard({\n  label,\n  value,\n  comment,\n}: {\n  label: string;\n  value: number | null;\n  comment?: string;\n}) {\n  return (\n    <div className=\"rounded-xl border border-slate-200 bg-white p-3\">\n      <p className=\"text-[11px] font-semibold uppercase tracking-wide text-slate-500\">\n        {label}\n      </p>\n      <p className=\"mt-1 text-xl font-semibold text-slate-900\">\n        {value ?? \"—\"}\n      </p>\n      {comment && (\n        <p className=\"mt-1 text-xs text-slate-600 leading-snug\">{comment}</p>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}