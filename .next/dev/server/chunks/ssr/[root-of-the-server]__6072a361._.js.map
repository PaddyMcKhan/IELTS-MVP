{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/lordp/IELTS-MVP/src/lib/taskLabels.ts"],"sourcesContent":["// lib/taskLabels.ts\n\nexport const TASK_LABELS: Record<string, string> = {\n  \"a-t2-education\": \"Academic Task 2 — Education\",\n  \"a-t2-environment\": \"Academic Task 2 — Environment\",\n  \"a-t2-technology\": \"Academic Task 2 — Technology & Society\",\n  \"g-t1-letter-neighbour\": \"General Task 1 — Letter to a Neighbour\",\n  \"g-t2-work-life\": \"General Task 2 — Work–Life Balance\",\n  // add more as your dataset grows\n};\n\nexport function formatTaskLabel(taskId: string | null | undefined): string {\n  if (!taskId) return \"Unknown task\";\n  return TASK_LABELS[taskId] ?? taskId; // fallback = raw ID\n}\n\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;;;AAEb,MAAM,cAAsC;IACjD,kBAAkB;IAClB,oBAAoB;IACpB,mBAAmB;IACnB,yBAAyB;IACzB,kBAAkB;AAEpB;AAEO,SAAS,gBAAgB,MAAiC;IAC/D,IAAI,CAAC,QAAQ,OAAO;IACpB,OAAO,WAAW,CAAC,OAAO,IAAI,QAAQ,oBAAoB;AAC5D","debugId":null}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/lordp/IELTS-MVP/src/app/attempts/%5Bid%5D/page.tsx"],"sourcesContent":["// src/app/attempts/[id]/page.tsx\n\nimport { notFound } from \"next/navigation\";\nimport { headers } from \"next/headers\";\nimport { formatTaskLabel } from \"@/lib/taskLabels\";\n\n// Next 16: params may be a Promise or a plain object\ntype PageProps = {\n  params: Promise<{ id: string }> | { id: string };\n};\n\ntype Attempt = {\n  id: string;\n  created_at: string | null;\n  question_id: string | null;\n  question_text?: string | null;\n  essay_text: string | null;\n  score_json: any;\n};\n\nexport default async function AttemptDetailPage(props: PageProps) {\n  // ✅ Safely unwrap params\n  const { id: attemptId } =\n    props.params instanceof Promise ? await props.params : props.params;\n\n  // ✅ Build an absolute base URL from the incoming request headers\n  const h = headers();\n  const host = h.get(\"x-forwarded-host\") ?? h.get(\"host\");\n  const protocol = h.get(\"x-forwarded-proto\") ?? \"http\";\n\n  if (!host) {\n    // Should never happen in normal requests, but be safe\n    return notFound();\n  }\n\n  const baseUrl = `${protocol}://${host}`;\n\n  // ✅ Use absolute URL so Node's fetch is happy\n  const res = await fetch(\n    `${baseUrl}/api/attempts/${encodeURIComponent(attemptId)}`,\n    {\n      cache: \"no-store\",\n    }\n  );\n\n  if (!res.ok) {\n    return notFound();\n  }\n\n  const json = await res.json();\n  const attempt: Attempt | undefined = json.attempt;\n\n  if (!attempt) {\n    return notFound();\n  }\n\n  // ---------- Parse score_json safely ----------\n  let score: any | null = null;\n  const rawScore = attempt.score_json;\n\n  if (rawScore && typeof rawScore === \"object\") {\n    score = rawScore;\n  } else if (rawScore && typeof rawScore === \"string\") {\n    try {\n      score = JSON.parse(rawScore);\n    } catch (e) {\n      console.warn(\"Failed to parse score_json for attempt\", attempt.id, e);\n    }\n  }\n\n  const overall =\n    score && typeof score.overall === \"number\" ? score.overall : null;\n\n  const taskResponse =\n    score && typeof score.taskResponse === \"number\"\n      ? score.taskResponse\n      : null;\n  const coherence =\n    score && typeof score.coherence === \"number\" ? score.coherence : null;\n  const lexical =\n    score && typeof score.lexical === \"number\" ? score.lexical : null;\n  const grammar =\n    score && typeof score.grammar === \"number\" ? score.grammar : null;\n\n  const dateText = attempt.created_at\n    ? new Date(attempt.created_at).toLocaleString()\n    : \"unknown date\";\n\n  const taskLabel = attempt.question_id\n    ? formatTaskLabel(attempt.question_id)\n    : \"Unknown task\";\n\n  const overviewComment: string | undefined =\n    score?.comments?.overview || score?.comments?.advice;\n\n  return (\n    <main className=\"min-h-dvh bg-white text-slate-900 p-6\">\n      <div className=\"mx-auto max-w-3xl space-y-8\">\n        {/* Header */}\n        <header className=\"space-y-1\">\n          <h1 className=\"text-2xl font-semibold\">Attempt Details</h1>\n          <p className=\"text-xs text-slate-500\">Submitted on {dateText}</p>\n        </header>\n\n        {/* Task */}\n        <section className=\"space-y-2\">\n          <h2 className=\"text-lg font-semibold\">Task</h2>\n          <p className=\"text-sm text-slate-700\">{taskLabel}</p>\n          {attempt.question_id && (\n            <p className=\"text-[11px] text-slate-400\">\n              ({attempt.question_id})\n            </p>\n          )}\n          {attempt.question_text && (\n            <p className=\"mt-1 text-xs text-slate-500\">\n              {attempt.question_text}\n            </p>\n          )}\n        </section>\n\n        {/* AI BAND SCORES */}\n        {score && (\n          <section className=\"space-y-3\">\n            <h2 className=\"text-lg font-semibold\">AI band scores</h2>\n\n            {/* Overall + Model */}\n            <div className=\"grid grid-cols-2 gap-3 text-sm\">\n              <div className=\"rounded-md bg-slate-50 p-3\">\n                <p className=\"text-xs text-slate-500 uppercase\">\n                  Overall Band\n                </p>\n                <p className=\"text-2xl font-semibold\">\n                  {overall ?? \"—\"}\n                </p>\n                {overviewComment && (\n                  <p className=\"mt-1 text-xs text-slate-600\">\n                    {overviewComment}\n                  </p>\n                )}\n              </div>\n              <div className=\"rounded-md bg-slate-50 p-3\">\n                <p className=\"text-xs text-slate-500 uppercase\">\n                  Model Used\n                </p>\n                <p className=\"text-sm font-medium\">\n                  {score.modelUsed ?? \"unknown\"}\n                </p>\n              </div>\n            </div>\n\n            {/* 4 category cards */}\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm\">\n              <div className=\"rounded-md bg-slate-50 p-3\">\n                <p className=\"text-xs text-slate-500 uppercase\">\n                  Task Response\n                </p>\n                <p className=\"font-medium\">{taskResponse ?? \"—\"}</p>\n              </div>\n              <div className=\"rounded-md bg-slate-50 p-3\">\n                <p className=\"text-xs text-slate-500 uppercase\">\n                  Coherence &amp; Cohesion\n                </p>\n                <p className=\"font-medium\">{coherence ?? \"—\"}</p>\n              </div>\n              <div className=\"rounded-md bg-slate-50 p-3\">\n                <p className=\"text-xs text-slate-500 uppercase\">\n                  Lexical Resource\n                </p>\n                <p className=\"font-medium\">{lexical ?? \"—\"}</p>\n              </div>\n              <div className=\"rounded-md bg-slate-50 p-3\">\n                <p className=\"text-xs text-slate-500 uppercase\">\n                  Grammar Accuracy\n                </p>\n                <p className=\"font-medium\">{grammar ?? \"—\"}</p>\n              </div>\n            </div>\n          </section>\n        )}\n\n        {/* Essay */}\n        <section className=\"space-y-3\">\n          <h2 className=\"text-lg font-semibold\">Your Essay</h2>\n          <div className=\"rounded-md bg-slate-50 p-4 text-sm whitespace-pre-wrap text-slate-800\">\n            {attempt.essay_text ?? \"No essay text stored for this attempt.\"}\n          </div>\n        </section>\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}